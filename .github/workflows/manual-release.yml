name: æ‰‹åŠ¨å‘å¸ƒ

on:
  workflow_dispatch:
    inputs:
      version:
        description: "å‘å¸ƒç‰ˆæœ¬å· (ä¾‹å¦‚: 1.0.1)"
        required: true
        type: string
      prerelease:
        description: "æ˜¯å¦ä¸ºé¢„å‘å¸ƒç‰ˆæœ¬"
        required: false
        type: boolean
        default: false
      force_release:
        description: "å¼ºåˆ¶å‘å¸ƒ (è¦†ç›–ç°æœ‰æ ‡ç­¾/Release)"
        required: false
        type: boolean
        default: false

# æ·»åŠ å¿…è¦çš„æƒé™è®¾ç½®
permissions:
  contents: write  # å…è®¸åˆ›å»º Release å’Œä¸Šä¼ æ–‡ä»¶
  actions: read    # å…è®¸è¯»å– Actions çŠ¶æ€
  checks: read     # å…è®¸è¯»å–æ£€æŸ¥çŠ¶æ€

env:
  BUILD_CONFIGURATION: Release
  PROJECT_NAME: TinyPin

jobs:
  manual-release:
    runs-on: windows-latest

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½®MSBuild
        uses: microsoft/setup-msbuild@v2

      - name: éªŒè¯ç‰ˆæœ¬æ ¼å¼
        shell: pwsh
        run: |
          $version = "${{ github.event.inputs.version }}"
          if ($version -notmatch '^\d+\.\d+\.\d+$') {
            Write-Error "ç‰ˆæœ¬å·æ ¼å¼é”™è¯¯ï¼Œåº”ä¸º x.y.z æ ¼å¼ï¼Œä¾‹å¦‚: 1.0.1"
            exit 1
          }
          echo "âœ“ ç‰ˆæœ¬å·æ ¼å¼æ­£ç¡®: $version"

      - name: åˆ›å»ºæ„å»ºç›®å½•
        run: |
          mkdir -p build/compile/Release/x64
          mkdir -p build/compile/Release/Win32
          mkdir -p build/compile/Release/ARM64
          mkdir -p build/installer

      - name: æ„å»ºæ‰€æœ‰å¹³å°
        shell: pwsh
        run: |
          $platforms = @("x64", "Win32", "ARM64")

          foreach ($platform in $platforms) {
            Write-Host "ğŸ”¨ æ„å»º $platform ç‰ˆæœ¬..."
            msbuild TinyPin.sln /p:Configuration=${{ env.BUILD_CONFIGURATION }} /p:Platform=$platform /p:OutDir="build\compile\Release\$platform\" /nologo /verbosity:minimal
            
            if ($LASTEXITCODE -ne 0) {
              Write-Error "$platform ç‰ˆæœ¬æ„å»ºå¤±è´¥"
              exit 1
            }
            
            $exePath = "build\compile\Release\$platform\TinyPin.exe"
            if (Test-Path $exePath) {
              $size = (Get-Item $exePath).Length
              Write-Host "âœ“ $platform ç‰ˆæœ¬æ„å»ºæˆåŠŸ (å¤§å°: $([math]::Round($size/1MB, 2)) MB)"
            } else {
              Write-Error "$platform ç‰ˆæœ¬å¯æ‰§è¡Œæ–‡ä»¶æœªæ‰¾åˆ°"
              exit 1
            }
          }

      - name: è¾“å‡ºç›®å½•ç»“æ„è°ƒè¯•ä¿¡æ¯
        shell: pwsh
        run: |
          Write-Host "ğŸ” å½“å‰å·¥ä½œç›®å½•: $(Get-Location)"
          Write-Host ""
          Write-Host "ğŸ“ é¡¹ç›®æ ¹ç›®å½•ç»“æ„:"
          Get-ChildItem -Path "." -Directory | ForEach-Object { Write-Host "  ğŸ“‚ $($_.Name)" }
          Write-Host ""
          Write-Host "ğŸ“ build ç›®å½•ç»“æ„:"
          if (Test-Path "build") {
            Get-ChildItem -Path "build" -Recurse | ForEach-Object {
              $relativePath = $_.FullName.Replace((Get-Location).Path, "").TrimStart('\')
              if ($_.PSIsContainer) {
                Write-Host "  ğŸ“‚ $relativePath"
              } else {
                $size = [math]::Round($_.Length/1KB, 2)
                Write-Host "  ğŸ“„ $relativePath ($size KB)"
              }
            }
          } else {
            Write-Host "  âŒ build ç›®å½•ä¸å­˜åœ¨"
          }
          Write-Host ""
          Write-Host "ğŸ“ tools ç›®å½•ç»“æ„:"
          if (Test-Path "tools") {
            Get-ChildItem -Path "tools" -Recurse -Depth 2 | ForEach-Object {
              $relativePath = $_.FullName.Replace((Get-Location).Path, "").TrimStart('\')
              if ($_.PSIsContainer) {
                Write-Host "  ğŸ“‚ $relativePath"
              } else {
                Write-Host "  ğŸ“„ $relativePath"
              }
            }
          } else {
            Write-Host "  âŒ tools ç›®å½•ä¸å­˜åœ¨"
          }

      - name: åˆ›å»ºæ‰€æœ‰å®‰è£…åŒ…
        shell: pwsh
        run: |
          $version = "${{ github.event.inputs.version }}"
          $platforms = @("x64", "Win32", "arm64")
          $isccPath = "tools\InnoSetup6\ISCC.exe"
          $scriptPath = "tools\Scripts\TinyPin.iss"
          $outputDir = "build\installer"

          foreach ($platform in $platforms) {
            Write-Host "ğŸ“¦ åˆ›å»º $platform å®‰è£…åŒ…..."
            $sourcePath = "build\compile\Release\$platform\TinyPin.exe"
            # è½¬æ¢ä¸ºç›¸å¯¹äºè„šæœ¬æ–‡ä»¶çš„è·¯å¾„ï¼ˆè„šæœ¬åœ¨ tools\Scripts\ ç›®å½•ä¸‹ï¼‰
            $relativeSourcePath = "..\..\build\compile\Release\$platform\TinyPin.exe"
            
            Write-Host "ğŸ” è°ƒè¯•ä¿¡æ¯:"
            Write-Host "  - å¹³å°: $platform"
            Write-Host "  - æºæ–‡ä»¶è·¯å¾„: $sourcePath"
            Write-Host "  - æºæ–‡ä»¶å­˜åœ¨: $(Test-Path $sourcePath)"
            Write-Host "  - ç›¸å¯¹æºæ–‡ä»¶è·¯å¾„: $relativeSourcePath"
            Write-Host "  - ISCC è·¯å¾„: $isccPath"
            Write-Host "  - ISCC å­˜åœ¨: $(Test-Path $isccPath)"
            Write-Host "  - è„šæœ¬è·¯å¾„: $scriptPath"
            Write-Host "  - è„šæœ¬å­˜åœ¨: $(Test-Path $scriptPath)"
            Write-Host "  - è¾“å‡ºç›®å½•: $outputDir"
            Write-Host "  - è¾“å‡ºç›®å½•å­˜åœ¨: $(Test-Path $outputDir)"
            Write-Host ""
            
            # ä»è„šæœ¬ç›®å½•æŸ¥çœ‹ç›¸å¯¹è·¯å¾„
            Write-Host "ğŸ“ ä»è„šæœ¬ç›®å½• (tools\Scripts) æŸ¥çœ‹ç›¸å¯¹è·¯å¾„:"
            Push-Location "tools\Scripts"
            try {
              Write-Host "  - å½“å‰ç›®å½•: $(Get-Location)"
              Write-Host "  - ç›¸å¯¹æºæ–‡ä»¶å­˜åœ¨: $(Test-Path $relativeSourcePath)"
              if (Test-Path "..\..\build") {
                Write-Host "  - build ç›®å½•å†…å®¹:"
                Get-ChildItem "..\..\build" -Recurse | ForEach-Object {
                  $relativePath = $_.FullName.Replace((Resolve-Path "..\..\build").Path, "build").Replace('\', '/')
                  if ($_.PSIsContainer) {
                    Write-Host "    ğŸ“‚ $relativePath"
                  } else {
                    Write-Host "    ğŸ“„ $relativePath"
                  }
                }
              }
            } finally {
              Pop-Location
            }
            Write-Host ""
            
            if (!(Test-Path $sourcePath)) {
              Write-Error "æºæ–‡ä»¶ä¸å­˜åœ¨: $sourcePath"
              exit 1
            }
            
            # ä½¿ç”¨ç›¸å¯¹äºè„šæœ¬æ–‡ä»¶çš„è·¯å¾„ï¼Œè¾“å‡ºåˆ°è„šæœ¬ç›®å½•ä¸‹çš„ build\installer
            $scriptOutputDir = "build\installer"
            
            Write-Host "ğŸ”§ æ‰§è¡Œ Inno Setup ç¼–è¯‘:"
            Write-Host "  - å‘½ä»¤: $isccPath $scriptPath /Dp=$platform /Ds=$relativeSourcePath /Do=$scriptOutputDir /Dv=$version"
            
            & $isccPath $scriptPath /Dp=$platform /Ds=$relativeSourcePath /Do=$scriptOutputDir /Dv=$version
            
            if ($LASTEXITCODE -ne 0) {
              Write-Error "$platform å®‰è£…åŒ…åˆ›å»ºå¤±è´¥"
              exit 1
            }
            
            # æ£€æŸ¥ Inno Setup å®é™…è¾“å‡ºçš„å®‰è£…åŒ…è·¯å¾„ï¼ˆåœ¨è„šæœ¬ç›®å½•ä¸‹ï¼‰
            # æ³¨æ„ï¼šå¦‚æœç‰ˆæœ¬å·æœªæ­£ç¡®ä¼ é€’ï¼ŒInno Setup å¯èƒ½ä½¿ç”¨é»˜è®¤ç‰ˆæœ¬å· 1.0.0
            $possibleVersions = @($version, "1.0.0")
            $scriptInstallerPath = $null
            $actualVersion = $null
            
            foreach ($testVersion in $possibleVersions) {
              $testPath = "tools\Scripts\$scriptOutputDir\TinyPin-$testVersion-$platform-setup.exe"
              if (Test-Path $testPath) {
                $scriptInstallerPath = $testPath
                $actualVersion = $testVersion
                break
              }
            }
            
            $finalInstallerPath = "$outputDir\TinyPin-$version-$platform-setup.exe"
            
            Write-Host "ğŸ” å®‰è£…åŒ…è·¯å¾„æ£€æŸ¥:"
            Write-Host "  - æœŸæœ›ç‰ˆæœ¬: $version"
            Write-Host "  - å®é™…ç‰ˆæœ¬: $actualVersion"
            Write-Host "  - è„šæœ¬è¾“å‡ºè·¯å¾„: $scriptInstallerPath"
            Write-Host "  - è„šæœ¬è¾“å‡ºå­˜åœ¨: $(if ($scriptInstallerPath) { Test-Path $scriptInstallerPath } else { 'false' })"
            Write-Host "  - æœ€ç»ˆç›®æ ‡è·¯å¾„: $finalInstallerPath"
            
            # åˆ—å‡ºè„šæœ¬è¾“å‡ºç›®å½•çš„æ‰€æœ‰æ–‡ä»¶
            $scriptOutputFullPath = "tools\Scripts\$scriptOutputDir"
            if (Test-Path $scriptOutputFullPath) {
              Write-Host "  - è„šæœ¬è¾“å‡ºç›®å½•å†…å®¹:"
              Get-ChildItem $scriptOutputFullPath | ForEach-Object {
                Write-Host "    ğŸ“„ $($_.Name)"
              }
            }
            
            if ($scriptInstallerPath -and (Test-Path $scriptInstallerPath)) {
              # ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨
              $targetDir = Split-Path $finalInstallerPath -Parent
              if (!(Test-Path $targetDir)) {
                New-Item -ItemType Directory -Path $targetDir -Force | Out-Null
              }
              
              # ç§»åŠ¨å®‰è£…åŒ…åˆ°æœ€ç»ˆä½ç½®
              Write-Host "ğŸ“¦ ç§»åŠ¨å®‰è£…åŒ…: $scriptInstallerPath -> $finalInstallerPath"
              Move-Item -Path $scriptInstallerPath -Destination $finalInstallerPath -Force
              
              if (Test-Path $finalInstallerPath) {
                $size = (Get-Item $finalInstallerPath).Length
                Write-Host "âœ“ $platform å®‰è£…åŒ…åˆ›å»ºæˆåŠŸ (å¤§å°: $([math]::Round($size/1MB, 2)) MB)"
                Write-Host "  - æœ€ç»ˆè·¯å¾„: $finalInstallerPath"
                if ($actualVersion -ne $version) {
                  Write-Host "  âš ï¸ æ³¨æ„: å®é™…ç‰ˆæœ¬å· ($actualVersion) ä¸æœŸæœ›ç‰ˆæœ¬å· ($version) ä¸åŒ¹é…"
                }
              } else {
                Write-Error "$platform å®‰è£…åŒ…ç§»åŠ¨å¤±è´¥"
                exit 1
              }
            } else {
              Write-Error "$platform å®‰è£…åŒ…æ–‡ä»¶æœªæ‰¾åˆ°"
              Write-Host "âŒ è°ƒè¯•ä¿¡æ¯:"
              Write-Host "  - æ£€æŸ¥çš„è·¯å¾„: $scriptInstallerPath"
              Write-Host "  - è„šæœ¬è¾“å‡ºç›®å½•: $scriptOutputFullPath"
              if (Test-Path $scriptOutputFullPath) {
                Write-Host "  - ç›®å½•ä¸­çš„æ–‡ä»¶:"
                Get-ChildItem $scriptOutputFullPath | ForEach-Object {
                  Write-Host "    ğŸ“„ $($_.Name)"
                }
              } else {
                Write-Host "  - è„šæœ¬è¾“å‡ºç›®å½•ä¸å­˜åœ¨"
              }
              exit 1
            }
          }

      - name: è¾“å‡ºå®‰è£…åŒ…åˆ›å»ºåçš„ç›®å½•ç»“æ„
        shell: pwsh
        run: |
          Write-Host "ğŸ“¦ å®‰è£…åŒ…åˆ›å»ºå®Œæˆåçš„ç›®å½•ç»“æ„:"
          Write-Host ""
          Write-Host "ğŸ“ é¡¹ç›®æ ¹ç›®å½• build\installer:"
          if (Test-Path "build\installer") {
            Get-ChildItem "build\installer" | ForEach-Object {
              if ($_.PSIsContainer) {
                Write-Host "  ğŸ“‚ $($_.Name)"
              } else {
                $size = [math]::Round($_.Length/1MB, 2)
                Write-Host "  ğŸ“„ $($_.Name) ($size MB)"
              }
            }
          } else {
            Write-Host "  âŒ build\installer ç›®å½•ä¸å­˜åœ¨"
          }
          Write-Host ""
          Write-Host "ğŸ“ è„šæœ¬ç›®å½• tools\Scripts\build\installer:"
          if (Test-Path "tools\Scripts\build\installer") {
            Get-ChildItem "tools\Scripts\build\installer" | ForEach-Object {
              if ($_.PSIsContainer) {
                Write-Host "  ğŸ“‚ $($_.Name)"
              } else {
                $size = [math]::Round($_.Length/1MB, 2)
                Write-Host "  ğŸ“„ $($_.Name) ($size MB)"
              }
            }
          } else {
            Write-Host "  âŒ tools\Scripts\build\installer ç›®å½•ä¸å­˜åœ¨"
          }

      - name: åˆ›å»ºå‘å¸ƒè¯´æ˜
        id: release_notes
        shell: pwsh
        run: |
          $version = "${{ github.event.inputs.version }}"
          $date = Get-Date -Format "yyyyå¹´MMæœˆddæ—¥"
          $prerelease = "${{ github.event.inputs.prerelease }}" -eq "true"
          $prereleaseText = if ($prerelease) { " (é¢„å‘å¸ƒç‰ˆæœ¬)" } else { "" }

          $releaseNotes = @"
          ## TinyPin $version$prereleaseText

          **å‘å¸ƒæ—¥æœŸ**: $date

          ### ğŸ“¦ å®‰è£…åŒ…ä¸‹è½½

          - **TinyPin-$version-x64-setup.exe** - é€‚ç”¨äº 64 ä½ Windows ç³»ç»Ÿ
          - **TinyPin-$version-Win32-setup.exe** - é€‚ç”¨äº 32 ä½å’Œ 64 ä½ Windows ç³»ç»Ÿ
          - **TinyPin-$version-arm64-setup.exe** - é€‚ç”¨äº ARM64 Windows ç³»ç»Ÿ

          ### ğŸ”§ ç³»ç»Ÿè¦æ±‚

          - Windows 7 SP1 æˆ–æ›´é«˜ç‰ˆæœ¬
          - å¯¹åº”çš„ç³»ç»Ÿæ¶æ„ (x64/x86/ARM64)

          ### ğŸ“ æ›´æ–°å†…å®¹

          æ­¤ç‰ˆæœ¬é€šè¿‡æ‰‹åŠ¨å‘å¸ƒæµç¨‹åˆ›å»ºï¼ŒåŒ…å«æœ€æ–°çš„åŠŸèƒ½æ”¹è¿›å’Œé”™è¯¯ä¿®å¤ã€‚

          ### ğŸš€ å®‰è£…è¯´æ˜

          1. ä¸‹è½½é€‚åˆæ‚¨ç³»ç»Ÿæ¶æ„çš„å®‰è£…åŒ…
          2. è¿è¡Œå®‰è£…ç¨‹åºå¹¶æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…
          3. å®‰è£…å®Œæˆåå¯åœ¨å¼€å§‹èœå•æ‰¾åˆ° TinyPin

          ---

          **é¡¹ç›®ä¸»é¡µ**: https://github.com/${{ github.repository }}
          "@

          $releaseNotes | Out-File -FilePath "release_notes.md" -Encoding UTF8
          echo "notes_file=release_notes.md" >> $env:GITHUB_OUTPUT

      - name: æ£€æŸ¥ GitHub Release å‰ç½®æ¡ä»¶
        shell: pwsh
        run: |
          $version = "${{ github.event.inputs.version }}"
          $tagName = "v$version"
          
          Write-Host "ğŸ” æ£€æŸ¥ GitHub Release å‰ç½®æ¡ä»¶:"
          Write-Host "  - ç‰ˆæœ¬å·: $version"
          Write-Host "  - æ ‡ç­¾å: $tagName"
          Write-Host "  - ä»“åº“: ${{ github.repository }}"
          Write-Host "  - æ˜¯å¦é¢„å‘å¸ƒ: ${{ github.event.inputs.prerelease }}"
          Write-Host ""
          
          # æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å·²å­˜åœ¨
          $forceRelease = "${{ github.event.inputs.force_release }}" -eq "true"
          Write-Host "ğŸ·ï¸ æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å·²å­˜åœ¨:"
          Write-Host "  - å¼ºåˆ¶å‘å¸ƒæ¨¡å¼: $forceRelease"
          try {
            $existingTags = git tag -l $tagName 2>$null
            if ($existingTags) {
              Write-Host "  âš ï¸ æ ‡ç­¾ $tagName å·²å­˜åœ¨"
              if ($forceRelease) {
                Write-Host "  ğŸ”„ å¼ºåˆ¶å‘å¸ƒæ¨¡å¼å·²å¯ç”¨ï¼Œå°†è¦†ç›–ç°æœ‰æ ‡ç­¾"
                Write-Host "  ğŸ“‹ åˆ é™¤ç°æœ‰æ ‡ç­¾..."
                git tag -d $tagName 2>$null
                git push origin :refs/tags/$tagName 2>$null
                Write-Host "  âœ“ ç°æœ‰æ ‡ç­¾å·²åˆ é™¤"
              } else {
                Write-Host "  ğŸ“‹ ç°æœ‰æ ‡ç­¾:"
                git tag -l | Sort-Object | ForEach-Object { Write-Host "    - $_" }
                Write-Host ""
                Write-Host "ğŸ’¡ è§£å†³æ–¹æ¡ˆ:"
                Write-Host "  1. ä½¿ç”¨ä¸åŒçš„ç‰ˆæœ¬å·"
                Write-Host "  2. å¯ç”¨ 'å¼ºåˆ¶å‘å¸ƒ' é€‰é¡¹æ¥è¦†ç›–ç°æœ‰ Release"
                Write-Host "  3. æ‰‹åŠ¨åˆ é™¤ç°æœ‰æ ‡ç­¾: git tag -d $tagName && git push origin :refs/tags/$tagName"
                Write-Error "æ ‡ç­¾ $tagName å·²å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºé‡å¤çš„ Release"
                exit 1
              }
            } else {
              Write-Host "  âœ“ æ ‡ç­¾ $tagName ä¸å­˜åœ¨ï¼Œå¯ä»¥åˆ›å»º"
            }
          } catch {
            Write-Host "  âš ï¸ æ— æ³•æ£€æŸ¥æ ‡ç­¾çŠ¶æ€: $($_.Exception.Message)"
            Write-Host "  ç»§ç»­æ‰§è¡Œ..."
          }
          Write-Host ""
          
          # æ£€æŸ¥å®‰è£…åŒ…æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          $installerFiles = @(
            "build/installer/TinyPin-$version-x64-setup.exe",
            "build/installer/TinyPin-$version-Win32-setup.exe", 
            "build/installer/TinyPin-$version-arm64-setup.exe"
          )
          
          Write-Host "ğŸ“¦ æ£€æŸ¥å®‰è£…åŒ…æ–‡ä»¶:"
          $allFilesExist = $true
          foreach ($file in $installerFiles) {
            $exists = Test-Path $file
            $status = if ($exists) { "âœ“" } else { "âŒ" }
            Write-Host "  $status $file"
            if ($exists) {
              $size = [math]::Round((Get-Item $file).Length/1MB, 2)
              Write-Host "      å¤§å°: $size MB"
            }
            if (!$exists) { $allFilesExist = $false }
          }
          
          if (!$allFilesExist) {
            Write-Error "éƒ¨åˆ†å®‰è£…åŒ…æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»º Release"
            exit 1
          }
          
          Write-Host ""
          Write-Host "âœ“ æ‰€æœ‰å‰ç½®æ¡ä»¶æ£€æŸ¥é€šè¿‡"

      - name: åˆ›å»º GitHub Release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ github.event.inputs.version }}
          name: TinyPin ${{ github.event.inputs.version }}
          body_path: ${{ steps.release_notes.outputs.notes_file }}
          draft: false
          prerelease: ${{ github.event.inputs.prerelease }}
          files: |
            build/installer/TinyPin-${{ github.event.inputs.version }}-x64-setup.exe
            build/installer/TinyPin-${{ github.event.inputs.version }}-Win32-setup.exe
            build/installer/TinyPin-${{ github.event.inputs.version }}-arm64-setup.exe
          fail_on_unmatched_files: true
          generate_release_notes: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: GitHub Release åˆ›å»ºç»“æœ
        if: always()
        shell: pwsh
        run: |
          $version = "${{ github.event.inputs.version }}"
          $releaseUrl = "${{ steps.create_release.outputs.url }}"
          
          if ("${{ steps.create_release.outcome }}" -eq "success") {
            Write-Host "âœ… GitHub Release åˆ›å»ºæˆåŠŸï¼"
            Write-Host "ğŸ”— Release URL: $releaseUrl"
          } else {
            Write-Host "âŒ GitHub Release åˆ›å»ºå¤±è´¥"
            Write-Host "ğŸ“‹ å¯èƒ½çš„åŸå› :"
            Write-Host "  1. æƒé™ä¸è¶³ - æ£€æŸ¥ GITHUB_TOKEN æƒé™"
            Write-Host "  2. æ ‡ç­¾å·²å­˜åœ¨ - æ ‡ç­¾ v$version å¯èƒ½å·²ç»å­˜åœ¨"
            Write-Host "  3. æ–‡ä»¶ä¸å­˜åœ¨ - æ£€æŸ¥å®‰è£…åŒ…æ–‡ä»¶è·¯å¾„"
            Write-Host "  4. ç½‘ç»œé—®é¢˜ - GitHub API å¯èƒ½æš‚æ—¶ä¸å¯ç”¨"
            Write-Host ""
            Write-Host "ğŸ”§ è°ƒè¯•ä¿¡æ¯:"
            Write-Host "  - ä»“åº“: ${{ github.repository }}"
            Write-Host "  - æ ‡ç­¾: v$version"
            Write-Host "  - Actor: ${{ github.actor }}"
            Write-Host "  - å·¥ä½œæµ: ${{ github.workflow }}"
            Write-Host "  - è¿è¡ŒID: ${{ github.run_id }}"
            
            # æ£€æŸ¥æ˜¯å¦æ˜¯æƒé™é—®é¢˜
            if ("${{ steps.create_release.outputs.url }}" -eq "") {
              Write-Host ""
              Write-Host "ğŸ’¡ å»ºè®®è§£å†³æ–¹æ¡ˆ:"
              Write-Host "  1. ç¡®ä¿ä»“åº“è®¾ç½®ä¸­å¯ç”¨äº† Actions çš„å†™å…¥æƒé™"
              Write-Host "  2. æ£€æŸ¥æ˜¯å¦æœ‰åˆ†æ”¯ä¿æŠ¤è§„åˆ™é˜»æ­¢äº†æ“ä½œ"
              Write-Host "  3. å°è¯•åˆ é™¤å·²å­˜åœ¨çš„æ ‡ç­¾ï¼ˆå¦‚æœå­˜åœ¨ï¼‰"
              Write-Host "  4. æ£€æŸ¥ GitHub æœåŠ¡çŠ¶æ€: https://www.githubstatus.com/"
            }
            
            exit 1
          }

      - name: å‘å¸ƒå®Œæˆé€šçŸ¥
        shell: pwsh
        run: |
          $version = "${{ github.event.inputs.version }}"
          $prerelease = "${{ github.event.inputs.prerelease }}" -eq "true"
          $prereleaseText = if ($prerelease) { " (é¢„å‘å¸ƒç‰ˆæœ¬)" } else { "" }

          Write-Host "ğŸ‰ TinyPin $version$prereleaseText æ‰‹åŠ¨å‘å¸ƒå®Œæˆï¼"
          Write-Host ""
          Write-Host "ğŸ“¦ ç”Ÿæˆçš„å®‰è£…åŒ…ï¼š"
          Get-ChildItem "build\installer\*.exe" | ForEach-Object {
            $size = [math]::Round($_.Length/1MB, 2)
            Write-Host "  - $($_.Name) ($size MB)"
          }
          Write-Host ""
          Write-Host "ğŸš€ å·²å‘å¸ƒåˆ° GitHub Releases: v$version"
          Write-Host "ğŸ”— å‘å¸ƒé¡µé¢: https://github.com/${{ github.repository }}/releases/tag/v$version"
